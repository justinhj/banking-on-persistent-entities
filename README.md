# banking-on-persistent-entities

This code is a companion to the blog post Banking on Persistent Entities. It implements a sample Lagom persistent entity that simulates a simple bank account. What is not covered in the blog post is the REST HTTP service that you can use to work with the persistent entity.

## Usage

To run the persistent entity test suite:

`sbt test`

To run the full Lagom service with Cassandra and Kafka and the HTTP service:

`sbt runAll`

In another terminal you can use curl to execute commands:

Deposit 100 to account with account id 1000 with the comment "savings"

`curl -X PUT localhost:9000/api/bankaccount/deposit/1000/savings/100`
> 100

and another 100

`curl -X PUT localhost:9000/api/bankaccount/deposit/1000/more%20savings/100`
> 200

Withdraw 250
`curl -X PUT localhost:9000/api/bankaccount/withdraw/1000/savings/250`
> {"type":"FailedWithdrawalResponse","message":"Insufficient funds (current balance 200)"}

Oops, not enough money, withdraw 100

`curl -X PUT localhost:9000/api/bankaccount/withdraw/1000/savings/100`
> {"type":"SuccessfulWithdrawalResponse","newBalance":100}

Let's set the account holder to Chuck Norris
`curl -X PUT localhost:9000/api/bankaccount/assignholder/1000/Chuck%20Norris`

And GET the final account

`curl localhost:9000/api/bankaccount/1000`
> {"id":"1000","balance":100,"accountHolder":"Chuck Norris"}`

## Lagom 

This project was been generated by the lagom/lagom-scala.g8 template. 

For instructions on running and testing the project, see https://www.lagomframework.com/get-started-scala.html.
